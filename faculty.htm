<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Management</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        * {
            transition: all 0.3s ease;
            scroll-behavior: smooth;
        }
        
        input:focus, select:focus {
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.4);
            border-color: #3498db;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .container {
            scrollbar-width: thin;
            scrollbar-color: #3498db transparent;
        }
        
        .container::-webkit-scrollbar {
            width: 8px;
        }
        
        .container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .container::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 4px;
        }
        
        .container::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .dept-info {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            font-weight: bold;
        }
        .add-faculty {
            background: #27ae60;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            transition: background 0.3s;
        }
        .add-faculty:hover {
            background: #219a52;
        }
        .faculty-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .faculty-card {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .faculty-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        .faculty-name {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .faculty-initials {
            color: #7f8c8d;
            margin-bottom: 8px;
        }
        .faculty-type {
            background: #3498db;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 15px;
        }
        .faculty-actions {
            display: flex;
            gap: 10px;
        }
        .edit-btn, .delete-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        .edit-btn {
            background: #f39c12;
            color: white;
        }
        .edit-btn:hover {
            background: #e67e22;
        }
        .delete-btn {
            background: #e74c3c;
            color: white;
        }
        .delete-btn:hover {
            background: #c0392b;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .save-btn, .cancel-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        .save-btn {
            background: #27ae60;
            color: white;
        }
        .save-btn:hover {
            background: #219a52;
        }
        .cancel-btn {
            background: #95a5a6;
            color: white;
        }
        .cancel-btn:hover {
            background: #7f8c8d;
        }
        .back-btn {
            background: #34495e;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
            transition: background 0.3s;
        }
        .back-btn:hover {
            background: #2c3e50;
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
        }
        .no-faculty {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="page.htm" class="back-btn" id="backBtn">‚Üê Back to Main Menu</a>
        
        <div class="header">
            <h1>Faculty Management - MIT Mysore</h1>
            <div class="dept-info" id="deptInfo">Department: Loading...</div>
        </div>

        <button class="add-faculty" onclick="openModal()">+ Add New Faculty</button>

        <div id="loadingDiv" class="loading">Loading faculty data...</div>
        <div id="facultyContainer" class="faculty-grid" style="display: none;"></div>
        <div id="noFacultyDiv" class="no-faculty" style="display: none;">
            No faculty members found for this department. Click "Add New Faculty" to get started.
        </div>
    </div>

    <!-- Modal for Add/Edit Faculty -->
    <div id="facultyModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Add New Faculty</h2>
            <form id="facultyForm">
                <div class="form-group">
                    <label for="facultyName">Full Name:</label>
                    <input type="text" id="facultyName" required>
                </div>
                <div class="form-group">
                    <label for="facultyInitials">Initials:</label>
                    <input type="text" id="facultyInitials" required placeholder="e.g., ABC, XYZ">
                </div>
                <div class="form-group">
                    <label for="facultyType">Type:</label>
                    <select id="facultyType" required>
                        <option value="">Select Type</option>
                        <option value="Faculty">Faculty</option>
                        <option value="Lab Assistant">Lab Assistant</option>
                        <option value="Professor">Professor</option>
                        <option value="Associate Professor">Associate Professor</option>
                        <option value="Assistant Professor">Assistant Professor</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="save-btn">Save Faculty</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://bkmzyhroignpjebfpqug.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrbXp5aHJvaWducGplYmZwcXVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MjA1NDUsImV4cCI6MjA3Mjk5NjU0NX0.ICE2eYzFZvz0dtNpAa5YlJTZD-idc2J76wn1ZeHwwck';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Get department from URL
        const urlParams = new URLSearchParams(window.location.search);
        const currentDepartment = urlParams.get('dept') || localStorage.getItem('currentDepartment') || 'ISE';
        
        // Update UI with department info
        document.getElementById('deptInfo').textContent = `${currentDepartment} Department - MIT Mysore`;
        document.getElementById('backBtn').href = `page.htm?dept=${encodeURIComponent(currentDepartment)}`;

        let editingFacultyId = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            createFacultyTable();
            loadFaculty();
        });

        // Create faculty table if it doesn't exist
        async function createFacultyTable() {
            try {
                // Check if table exists by trying to select from it
                const { data, error } = await supabase
                    .from('faculty')
                    .select('id')
                    .limit(1);
                
                if (error && error.code === '42P01') {
                    // Table doesn't exist, but we can't create it with the anon key
                    console.log('Faculty table needs to be created in Supabase dashboard');
                }
            } catch (error) {
                console.log('Table check completed');
            }
        }

        // Load faculty data
        async function loadFaculty() {
            try {
                const { data, error } = await supabase
                    .from('faculty')
                    .select('*')
                    .eq('department', currentDepartment)
                    .order('name');

                document.getElementById('loadingDiv').style.display = 'none';

                if (error) {
                    console.error('Error loading faculty:', error);
                    document.getElementById('noFacultyDiv').style.display = 'block';
                    document.getElementById('noFacultyDiv').innerHTML = 'Error loading faculty data. Please ensure the faculty table exists in Supabase.';
                    return;
                }

                if (data && data.length > 0) {
                    displayFaculty(data);
                } else {
                    document.getElementById('noFacultyDiv').style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('noFacultyDiv').style.display = 'block';
                document.getElementById('noFacultyDiv').innerHTML = 'Error connecting to database. Please check your connection.';
            }
        }

        // Display faculty data
        function displayFaculty(facultyList) {
            const container = document.getElementById('facultyContainer');
            container.innerHTML = '';
            container.style.display = 'grid';

            facultyList.forEach(faculty => {
                const facultyCard = document.createElement('div');
                facultyCard.className = 'faculty-card';
                facultyCard.innerHTML = `
                    <div class="faculty-name">${faculty.name}</div>
                    <div class="faculty-initials">Initials: ${faculty.initials}</div>
                    <div class="faculty-type">${faculty.type}</div>
                    <div class="faculty-actions">
                        <button class="edit-btn" onclick="editFaculty(${faculty.id})">Edit</button>
                        <button class="delete-btn" onclick="deleteFaculty(${faculty.id})">Delete</button>
                    </div>
                `;
                container.appendChild(facultyCard);
            });
        }

        // Open modal for add/edit
        function openModal(faculty = null) {
            const modal = document.getElementById('facultyModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('facultyForm');

            if (faculty) {
                title.textContent = 'Edit Faculty';
                document.getElementById('facultyName').value = faculty.name;
                document.getElementById('facultyInitials').value = faculty.initials;
                document.getElementById('facultyType').value = faculty.type;
                editingFacultyId = faculty.id;
            } else {
                title.textContent = 'Add New Faculty';
                form.reset();
                editingFacultyId = null;
            }

            modal.style.display = 'block';
            setupFacultyFormNavigation();
            
            // Focus first input
            setTimeout(() => {
                document.getElementById('facultyName').focus();
            }, 100);
        }

        // Close modal
        function closeModal() {
            document.getElementById('facultyModal').style.display = 'none';
            editingFacultyId = null;
        }

        // Edit faculty
        async function editFaculty(id) {
            try {
                const { data, error } = await supabase
                    .from('faculty')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (error) {
                    alert('Error loading faculty data');
                    return;
                }

                openModal(data);
            } catch (error) {
                alert('Error loading faculty data');
            }
        }

        // Delete faculty
        async function deleteFaculty(id) {
            if (!confirm('Are you sure you want to delete this faculty member?')) {
                return;
            }

            try {
                const { error } = await supabase
                    .from('faculty')
                    .delete()
                    .eq('id', id);

                if (error) {
                    alert('Error deleting faculty');
                    return;
                }

                loadFaculty(); // Reload the list
            } catch (error) {
                alert('Error deleting faculty');
            }
        }

        // Setup keyboard navigation for faculty form
        function setupFacultyFormNavigation() {
            const formInputs = [
                document.getElementById('facultyName'),
                document.getElementById('facultyInitials'),
                document.getElementById('facultyType')
            ];
            
            formInputs.forEach((input, index) => {
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        if (index < formInputs.length - 1) {
                            formInputs[index + 1].focus();
                        } else {
                            document.querySelector('.save-btn').click();
                        }
                    }
                });
            });
        }

        // Handle form submission
        document.getElementById('facultyForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const name = document.getElementById('facultyName').value.trim();
            const initials = document.getElementById('facultyInitials').value.trim().toUpperCase();
            const type = document.getElementById('facultyType').value;

            if (!name || !initials || !type) {
                alert('Please fill in all fields');
                return;
            }

            const facultyData = {
                name: name,
                initials: initials,
                type: type,
                department: currentDepartment
            };

            try {
                let result;
                if (editingFacultyId) {
                    // Update existing faculty
                    result = await supabase
                        .from('faculty')
                        .update(facultyData)
                        .eq('id', editingFacultyId);
                } else {
                    // Add new faculty
                    result = await supabase
                        .from('faculty')
                        .insert([facultyData]);
                }

                if (result.error) {
                    alert('Error saving faculty: ' + result.error.message);
                    return;
                }

                closeModal();
                loadFaculty(); // Reload the list
            } catch (error) {
                alert('Error saving faculty data');
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('facultyModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>